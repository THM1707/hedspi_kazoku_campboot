  <script>
  $(document).ready(function(){
      var rated = 0;
      <% if @cur_review %>
      rated = <%=  @cur_review.rating %>;
      <% end %>
  
      let stars = $(`#stars`).find(`li`).parent().children('li.star');
      for (let i = 0; i < rated; i++) {
          $(stars[i]).addClass('selected');
      }
      $('#stars li').on('mouseover', function(){
          var onStar = parseInt($(this).data('value'), 10); // The star currently mouse on
  
          // Now highlight all the stars that's not after the current hovered star
          $(this).parent().children('li.star').each(function(e){
              if (e < onStar) {
                  $(this).addClass('hover');
              }
              else {
                  $(this).removeClass('hover');
              }
          });
  
      }).on('mouseout', function(){
          $(this).parent().children('li.star').each(function(e){
              $(this).removeClass('hover');
          });
      });
  
  
      $('#stars li').on('click', function(){
          var onStar = parseInt($(this).data('value'), 10);
          var stars = $(this).parent().children('li.star');
  
          for (i = 0; i < stars.length; i++) {
              $(stars[i]).removeClass('selected');
          }
  
          for (i = 0; i < onStar; i++) {
              $(stars[i]).addClass('selected');
          }
  
  
          var ratingValue = parseInt($('#stars li.selected').last().data('value'), 10);
          var user_id = <%= current_user.id %>;
          var company_id = <%= @company.id %>;
          var settings = {
              "async": true,
              "crossDomain": true,
              "url": `/companies/${company_id}/reviews`,
              "method": "POST",
              "headers": {
                  "Content-Type": "application/json",
                  "cache-control": "no-cache",
              },
              "processData": false,
              "data":  `{"rating":"${ratingValue}", "user_id":"${user_id}"}`
          }
  
          $.ajax(settings).done(function (response) {
              $( ".avg-count" ).text(`${response.count} reviews `);
              $( ".avg" ).html(`${response.average} <i class='fa fa-star fa-fw'></i>`);
              google.charts.setOnLoadCallback(function() {
                drawBasic(response.review['5'],response.review['4'],response.review['3'],response.review['2'],response.review['1']);
              });
          });
      });
  });
</script>


<script>
  $(document).ready(function(){
    let star5 = <%= @company.reviews.star(5).count %>;
    let star4 = <%= @company.reviews.star(4).count %>;
    let star3 = <%= @company.reviews.star(3).count %>;
    let star2 = <%= @company.reviews.star(2).count %>;
    let star1 = <%= @company.reviews.star(1).count %>;
    google.charts.setOnLoadCallback(function() { drawBasic(
      star5,star4,star3,star2,star1
      );
    });
  });
</script>
